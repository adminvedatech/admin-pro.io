if("undefined"==typeof jQuery)throw new Error("Tabledit requires jQuery library.");!function(t){"use strict";var e={init:function(e){var n=this;if("TABLE"!==n.prop("tagName"))throw new Error("Tabledit only works when applied to a table.");var i=function(t){return void 0!==t||null!==t||""!==t};if(!i(e.columns))return console.log("Tabledit Jquery Plugin not initialize. Set required parameters."),this;e.lang=i(e.lang)&&e.lang in n.Tabledit.langs?e.lang.toLowerCase():n.Tabledit.defaults.lang;var a=t.extend({},n.Tabledit.defaults,e);t(this).data("_TableditData",t.extend({},n.Tabledit.defaults,e||{}));var s="undefined",l="undefined";if(a.editButton&&a.buttons.edit.html)var o=a.buttons.edit.html;else o=n.Tabledit.langs[a.lang].btn_edit;if(a.deleteButton&&a.buttons.delete.html)var d=a.buttons.delete.html;else d=n.Tabledit.langs[a.lang].btn_delete;if(a.confirmButton&&a.buttons.confirm.html)var r=a.buttons.confirm.html;else r=n.Tabledit.langs[a.lang].btn_confirm;if(a.saveButton&&a.buttons.save.html)var u=a.buttons.save.html;else u=n.Tabledit.langs[a.lang].btn_save;if(a.restoreButton&&a.buttons.restore.html)var b=a.buttons.restore.html;else b=n.Tabledit.langs[a.lang].btn_restore;function c(t){var e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"","'":"","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};return String(t).replace(/[&<>"'`=\/]/g,(function(t){return e[t]}))}function f(i){var o,d,r=n.find(".tabledit-input").serialize();return!!r&&!1!==(d=a.onAjax(i,r+="&action="+i))&&(r=d,a.method=a[i+"method"],t.ajaxSetup({beforeSend:function(t,e){/^(GET|HEAD|OPTIONS|TRACE)$/.test(e.type)||this.crossDomain||t.setRequestHeader("X-CSRFToken",function(t){var e=null;if(document.cookie&&""!=document.cookie)for(var n=document.cookie.split(";"),i=0;i<n.length;i++){var a=jQuery.trim(n[i]);if(a.substring(0,t.length+1)==t+"="){e=decodeURIComponent(a.substring(t.length+1));break}}return e}("csrftoken"))}}),(o=t.ajax({url:a.url,type:a.method,data:r,dataType:"json"})).done((function(t,e,l){"success"==e?(i===a.buttons.edit.action&&(s.removeClass(a.dangerClass).addClass(a.successClass),setTimeout((function(){n.find("tr."+a.successClass).removeClass(a.successClass)}),1500)),a.onSuccess(t,e,l)):a.onFail(e)})),o.fail((function(t,n,o){i===a.buttons.delete.action?(l.removeClass(a.mutedClass).addClass(a.dangerClass),l.find(".tabledit-toolbar button").attr("disabled",!1),l.find(".tabledit-toolbar .tabledit-restore-button").hide()):i===a.buttons.edit.action&&s.addClass(a.dangerClass),a.onFail(t,exception),e.debug&&console.log(function(t,e,n){return t.status?{0:"Not connect. Verify Network.",400:"Server understood the request, but request content was invalid [400].",401:"Unauthorized access [401].",403:"Forbidden resource can not be accessed [403].",404:"Requested page not found. [404]",500:"Internal Server Error [500].",503:"Service unavailable [503]."}[t.status]:"parsererror"==e?"Ajax Error!! Parsing JSON Request failed. \nDetail =>"+e+" : "+n:"timeout"===e?"Time out error.":"abort"===e?"Ajax request aborted.":"Uncaught Error.\n"+t.responseText}(t,n,o))})),o.always((function(){a.onAlways()})),o)}e.debug&&console.log("Tabledit Init -> Element:",n),e.debug&&console.log("Tabledit Init -> dataPrefix:","_TableditData"),e.debug&&console.log("Tabledit Init -> Settings: ",a),e.debug&&console.log("Tabledit Init: -----------------------------------");var p=function(e){var n=t(e).parent("tr");t(e).parent("tr").find(".tabledit-input.tabledit-identifier").prop("disabled",!0),t(e).find(".tabledit-input").blur().hide().prop("disabled",!0),t(e).find(".count_").hide(),t(e).find(".tabledit-span").show(),t(e).addClass("tabledit-view-mode").removeClass("tabledit-edit-mode"),a.editButton&&(n.find("button.tabledit-save-button").hide(),n.find("button.tabledit-edit-button").removeClass("active").blur())},h=function(e){g.reset(e);var n=t(e).parent("tr");n.find(".tabledit-input.tabledit-identifier").prop("disabled",!1),t(e).find(".tabledit-span").hide();var i=t(e).find(".tabledit-input");i.prop("disabled",!1).show(),t(e).find("textarea").css({resize:"none"}),t(e).find(".count_").css({color:"#CCC",display:"block",float:"right"}).show(),t(e).find(".countno_").html("..."),a.autoFocus&&i.focus(),t(e).addClass("tabledit-edit-mode").removeClass("tabledit-view-mode"),a.editButton&&(n.find("button.tabledit-edit-button").addClass("active"),n.find("button.tabledit-save-button").show())},m=function(e){t(e).each((function(){var e=t(this).find(".tabledit-input"),n=t.trim(t(this).find(".tabledit-span").text());e.is("select")?e.find("option").filter((function(){return t.trim(t(this).text())===n})).attr("selected",!0):e.val(n),p(this)}))},v=function(e){!1!==f(a.buttons.edit.action)&&(t(e).each((function(){var e=t(this).find(".tabledit-input");e.is("select")?t(this).find(".tabledit-span").text(t.trim(e.find("option:selected").text())):t(this).find(".tabledit-span").text(e.val()),p(this)})),s=t(e).parent("tr"))},g={reset:function(t){n.find(".tabledit-confirm-button").hide(),n.find(".tabledit-delete-button").removeClass("active").blur()},submit:function(e){g.reset(e),t(e).parent("tr").find("input.tabledit-identifier").attr("disabled",!1);var n=f(a.buttons.delete.action);t(e).closest("tr").find("input.tabledit-identifier").attr("disabled",!0),!1!==n&&(t(e).parent("tr").addClass("tabledit-deleted-row"),t(e).parent("tr").addClass(a.mutedClass).find(".tabledit-toolbar button:not(.tabledit-restore-button)").attr("disabled",!0),t(e).find(".tabledit-restore-button").show(),l=t(e).parent("tr"))},confirm:function(e){n.find("td.tabledit-edit-mode").each((function(){m(this)})),t(e).find(".tabledit-delete-button").addClass("active"),t(e).find(".tabledit-confirm-button").show()},restore:function(e){t(e).parent("tr").find("input.tabledit-identifier").attr("disabled",!1);var n=f(a.buttons.restore.action);t(e).closest("tr").find("input.tabledit-identifier").attr("disabled",!0),!1!==n&&(t(e).parent("tr").removeClass("tabledit-deleted-row"),t(e).parent("tr").removeClass(a.mutedClass).find(".tabledit-toolbar button").attr("disabled",!1),t(e).find(".tabledit-restore-button").hide(),t(e).parent("tr"))}};return a.hideIdentifier&&n.find("th:nth-child("+parseInt(a.columns.identifier[0])+"1), tbody td:nth-child("+parseInt(a.columns.identifier[0])+"1)").hide(),n.find('tbody tr:not(".'+a.noEditClass+'") td:not(".'+a.noEditClass+'")').filter(":nth-child("+(parseInt(a.columns.identifier[0])+1)+")").each((function(){var e=t.trim(t(this).text().replace(/^\s+|\s+$/g,"")),n='<span class="tabledit-span tabledit-identifier">'+(e=a.escapehtml?c(e):e)+"</span>",i='<input class="tabledit-input tabledit-identifier" type="hidden" name="'+a.columns.identifier[1]+'" value="'+e+'" disabled>';t(this).html(n+i),t(this).parent("tr").attr(a.rowIdentifier,t.trim(t(this).text()))})),function(){for(var e=0;e<a.columns.editable.length;e++)n.find('tbody tr:not(".'+a.noEditClass+'") td:not(".'+a.noEditClass+'")').filter(":nth-child("+(parseInt(a.columns.editable[e][0])+1)+")").each((function(){var i=t.trim(t(this).text().replace(/(^\s+|\s+$)/g,""));i=a.escapehtml?c(i):i,a.editButton||t(this).css("cursor","pointer");var s,l='<span class="tabledit-span">'+i+"</span>",o=["rows","cols","maxlength","wrap"],d=a.columns.editable[e][2];switch(-1==t.inArray(d,["input","hidden","number","date","select","textarea"])&&(d="input"),d){case"input":s='<input class="tabledit-input '+a.inputClass+'" type="text" name="'+a.columns.editable[e][1]+'" value="'+i+'" style="display: none;" disabled>';break;case"hidden":s='<input class="tabledit-input '+a.inputClass+'" type="hidden" name="'+a.columns.editable[e][1]+'" value="'+i+'" style="display: none;" disabled>';break;case"number":s='<input class="tabledit-input '+a.inputClass+'" type="number" name="'+a.columns.editable[e][1]+'" value="'+i+'" style="display: none;" disabled>';break;case"date":s='<input class="tabledit-input '+a.inputClass+'" type="date" name="'+a.columns.editable[e][1]+'" value="'+i+'" style="display: none;" disabled>';break;case"select":void 0!==a.columns.editable[e][3]&&(s='<select class="tabledit-input '+a.inputClass+'" name="'+a.columns.editable[e][1]+'" style="display: none;" disabled>',t.each(t.parseJSON(a.columns.editable[e][3]),(function(e,n){n=t.trim(n),s+=i===n?'<option value="'+e+'" selected>'+n+"</option>":'<option value="'+e+'">'+n+"</option>"})),s+="</select>");break;case"textarea":var r;s="<textarea ",void 0!==a.columns.editable[e][3]?t.each(t.parseJSON(a.columns.editable[e][3]),(function(e,i){s+=-1!=t.inArray(e,o)?e+'="'+i+'" ':"",r="maxlength"==e&&i.length>0?n.Tabledit.langs[a.lang].txt_allowchar.replace("%s",i)+' | <span class="countno_"></span> '+n.Tabledit.langs[a.lang].txt_remain:n.Tabledit.langs[a.lang].txt_nolimit})):r=n.Tabledit.langs[a.lang].txt_nolimit,s+=' class="tabledit-input '+a.inputClass+'" name="'+a.columns.editable[e][1]+'" style="display: none;" disabled>'+i+'</textarea><span class="count_" style="display: none;">'+r+"</span>"}t(this).html(l+s),t(this).addClass("tabledit-view-mode")}))}(),function(){if(a.editButton||a.deleteButton){var t="",e="",i="",s="",l="";0===n.find("th.tabledit-toolbar-column").length&&n.find("tr:first").append('<th class="tabledit-toolbar-column '+a.toolbarHeaderClass+'">'+n.Tabledit.langs[a.lang].txt_action+"</th>"),a.editButton&&(t='<button type="button" class="tabledit-edit-button '+a.buttons.edit.class+'" style="float: none;">'+o+"</button>"),a.deleteButton&&(e='<button type="button" class="tabledit-delete-button '+a.buttons.delete.class+'" style="float: none; ">'+d+"</button>",l='<button type="button" class="tabledit-confirm-button '+a.buttons.confirm.class+'" style="display: none; float: none; margin-left: 10px;">'+r+"</button>"),a.editButton&&a.saveButton&&(i='<button type="button" class="tabledit-save-button '+a.buttons.save.class+'" style="display: none; float: none; margin-left: 10px;">'+u+"</button>"),a.deleteButton&&a.restoreButton&&(s='<button type="button" class="tabledit-restore-button '+a.buttons.restore.class+'" style="display: none; float: none; margin-left: 10px;">'+b+"</button>");var c='<div class="tabledit-toolbar '+a.toolbarClass+'" style="text-align: left;flex-wrap: nowrap;">\n                                           <div class="'+a.groupClass+'" style="float: none;">'+t+e+"</div>\n                                           "+i+"\n                                           "+l+"\n                                           "+s+"\n                                       </div></div>";n.find('tbody > tr:not(".'+a.noEditClass+'")').append('<td class="toolbar" style="white-space: nowrap; width: 1%;">'+c+"</td>"),n.find("tbody > tr."+a.noEditClass).append('<td class="toolbar" style="white-space: nowrap; width: 1%;"></td>')}}(),a.onDraw(),a.deleteButton&&(n.on("click","button.tabledit-delete-button",(function(e){if(!0!==e.handled){e.preventDefault();var n=t(this).hasClass("active"),i=t(this).closest("td");g.reset(i),n||g.confirm(i),e.handled=!0}})),n.on("click","button.tabledit-confirm-button",(function(e){if(!0!==e.handled){e.preventDefault();var n=t(this).closest("td");g.submit(n),e.handled=!0}}))),a.restoreButton&&n.on("click","button.tabledit-restore-button",(function(e){!0!==e.handled&&(e.preventDefault(),g.restore(t(this).closest("td")),e.handled=!0)})),a.editButton?(n.on("click","button.tabledit-edit-button",(function(e){if(!0!==e.handled){e.preventDefault();var i=t(this),a=i.hasClass("active");m(n.find("td.tabledit-edit-mode")),a||t(i.closest("tr").find("td.tabledit-view-mode").get().reverse()).each((function(){h(this)})),e.handled=!0}})),n.on("click","button.tabledit-save-button",(function(e){!0!==e.handled&&(e.preventDefault(),v(t(this).closest("tr").find("td.tabledit-edit-mode")),e.handled=!0)}))):(n.on(a.eventType,"tr:not(.tabledit-deleted-row) td.tabledit-view-mode",(function(t){!0!==t.handled&&(t.preventDefault(),m(n.find("td.tabledit-edit-mode")),h(this),t.handled=!0)})),n.on("change","select.tabledit-input:visible",(function(e){!0!==e.handled&&(v(t(this).parent("td")),e.handled=!0)})),t(document).on("click",(function(t){var e=n.find(".tabledit-edit-mode");e.is(t.target)||0!==e.has(t.target).length||m(n.find(".tabledit-input:visible").parent("td"))}))),n.on("keypress",(function(t){var e=n.find(".tabledit-input:visible"),i=n.find(".tabledit-confirm-button");if(e.length>0)var s=e.parents("td");else{if(!(i.length>0))return;s=i.parents("td")}switch(t.keyCode){case 9:a.editButton||(v(s),h(s.closest("td").next()));break;case 13:t.preventDefault(),v(s);break;case 27:m(s),g.reset(s)}})),t("textarea").on("change keyup keydown",(function(){var e=t(this).val().length,n=t(this).attr("maxlength");void 0!==n&&!1!==n&&n.length>0&&(e=n-e,t(this).parent().find(".countno_").text(e))})),this},destroy:function(e){e.debug&&console.log("Tabledit Destroy -> Element:",t(this)),this.find(".tabledit-toolbar-column").remove(),this.find(".toolbar").remove(),this.find("td").each((function(){if(0!=t(this).find(".tabledit-input").length)var e=t.trim(t(this).find(".tabledit-span").text());else e=t.trim(t(this).html());t(this).html(e)}))},update:function(n){var i=t(this).data("_TableditData");if(i){(n=t.extend(!0,i,n)).debug&&console.log("Tabledit Update -> Element:",t(this)),n.debug&&console.log("Tabledit Update -> Settings: ",n);var a=t.parseJSON(JSON.stringify(n,["debug"]));e.destroy.apply(this,[a]),e.init.apply(this,[n])}else console.log("Tabledit Update -> Data: EditTable must be initialized before setting options")}};t.fn.Tabledit=function(n){return e[n]?e[n].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof n&&n?void t.error("Method "+n+" does not exist on jQuery.Tabledit"):e.init.apply(this,arguments)},t.fn.Tabledit.defaults={url:window.location.href,editmethod:"post",deletemethod:"post",toolbarHeaderClass:"",toolbarClass:"btn-toolbar",groupClass:"btn-group btn-group-sm",inputClass:"form-control input-sm",dangerClass:"danger",successClass:"success",mutedClass:"text-muted",noEditClass:"noedit",eventType:"click",rowIdentifier:"id",hideIdentifier:!1,autoFocus:!0,lang:"en",debug:!1,escapehtml:!0,editButton:!0,deleteButton:!0,saveButton:!0,restoreButton:!0,buttons:{edit:{class:"btn btn-sm btn-default",html:'<span class="glyphicon glyphicon-pencil"></span>',action:"edit"},delete:{class:"btn btn-sm btn-default",html:'<span class="glyphicon glyphicon-trash"></span>',action:"delete"},save:{class:"btn btn-sm btn-success",html:""},restore:{class:"btn btn-sm btn-warning",html:"",action:"restore"},confirm:{class:"btn btn-sm btn-danger",html:"Confirm"}},onDraw:function(){},onSuccess:function(){},onFail:function(){},onAlways:function(){},onAjax:function(){}},t.fn.Tabledit.langs={en:{btn_edit:"Edit",btn_delete:"Delete",btn_confirm:"Confirm",btn_save:"Save",btn_restore:"Restore",txt_action:"Actions",txt_nolimit:"Count of characters without limit",txt_allowchar:"Allowed count of characters %s",txt_remain:"characters remaining"},de:{btn_edit:"Editieren",btn_delete:"L&ouml;schen",btn_confirm:"Best&auml;tigen",btn_save:"Speichern",btn_restore:"Inhalt",txt_action:"Aktion",txt_nolimit:"",txt_allowchar:"",txt_remain:""},fr:{btn_edit:"Editer",btn_delete:"Supprimer",btn_confirm:"Confirmer",btn_save:"Enregistrer",btn_restore:"Restaurer",txt_action:"Actions",txt_nolimit:"Nombre de caractères sans limite",txt_allowchar:"Nombre de caractères autorisés %s",txt_remain:"caractères restants"},cz:{btn_edit:"Editovat",btn_delete:"Odstranit",btn_confirm:"Potvrdit",btn_save:"Uložit",btn_restore:"Obnovit",txt_action:"Akce",txt_nolimit:"Počet znaků bez omezení",txt_allowchar:"Povoleno celkem %s znaků",txt_remain:"znak(ů) zbývá"}}}(jQuery);